<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap.css">
    <link rel="stylesheet" href="style.css">
    <style>
        #cart1{
            margin: 30px;
            margin-top: 100px;
        }

        .text-center{
            padding: 20px;

            text-align: center;
        }
        img{
            width: 75px;
        }

        .pic{
          width: 50px;
        }

        #add-remove{
          display:flex;
        }
        button{
          padding: auto;
          margin: 10px;
        }
        th{
          vertical-align: middle;
        }
        td{
          vertical-align: middle;
        }

        .invalidText{
          color:red
        }

    </style>
    <title>Din varukorg - Sara's webbshop</title>
</head>
<body id="page">
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
        <a class="navbar-brand" href="index.html"><img src="logga.png" alt="logga" class="rounded-circle"></a>
       
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Våra produkter</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="cart.html">Din varukorg</a>
          </li>
        </ul>
      </nav>

    <div id="cart1" class="row">
        <div class="col-lg-4">
            <table class="table table-align-middle w-auto text-center" style="padding: 8px 20px;">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Bild</th>
                    <th scope="col">Namn</th>
                    <th scope="col">á</th>
                    <th scope="col">Antal</th>
                    <th scope="col" style="margin: 30px;">Total</th>
                  </tr>
                </thead>
                <tbody id="cart">
                </tbody>
                <tfoot>
                  <th scope="row">Total</th>
                  <td id="totalTotal" colspan="5" style="text-align: right;"> 0</td>
                </tfoot>
              </table>
        </div>
    
        <div class= "container col-lg-6" style="max-width: 700px; float: left;" id="infoForm" >
            <div class="row border bg-light">
                <div class="p-2 col-sm-6">
                    <div><label for="firstName" class="form-label">Förnamn</label>
                    <input type="text" class="form-control" id="firstName" placeholder="Förnamn" required></div>
                    <div><label for="firstaname" class="form-label invalidText" id="invalidFname" class = "invalid"></label></div>
                </div>
                <div class="p-2 col-sm-6">
                    <div><label for="lastName" class="form-label">Efternamn</label>
                        <input type="text" class="form-control" id="lastName" placeholder="Efternamn" required></div>
                        <div><label for="lastName" class="form-label invalidText" id="invalidLname" class = "invalid"></label></div>
                </div>
                <div class="p-2 col-sm-6">
                    <div><label for="email" class="form-label">E-mail</label>
                    <input type="email" class="form-control" id="email" placeholder="E-mail" required></div>
                    <div><label for="email" class="form-label invalidText" id="invalidEmail" class = "invalid"></label></div>
                </div>
                <div class="p-2 col-sm-6">
                    <div><label for="phone" class="form-label is-invalid">Telefon</label>
                        <input  type="tel" class="form-control" id="phone" placeholder="Telefon" required></div>
                        <div><label for="phone" class="form-label invalidText" id="invalidPhone" class = "invalid"></label></div>
                </div>
                <div class="p-2 col-sm-12">
                    <div><label for="street" class="form-label">Adress</label>
                        <input  type="text" class="form-control" id="street" placeholder="Adress" required></div>
                        <div><label for="street" class="form-label invalidText" id="invalidAdress" class = "invalid"></label></div>
                </div>
                <div class="p-2 col-sm-6">
                    <div><label for="zipCode" class="form-label">Postnummer</label>
                    <input  type="text" class="form-control" id="zipCode" placeholder="Postnummer" required></div>
                    <div><label for="zipCode" class="form-label invalidText" id="invalidZip" class = "invalid"></label></div>
                </div>
                <div class="p-2 col-sm-6">
                    <div><label for="com" class="form-label">Ort</label>
                        <input type="text" class="form-control" id="com" placeholder="Ort" required ></div>
                        <div><label for="com" class="form-label invalidText" id="invalidCom" class = "invalid"></label></div>
                </div>
                
              </div>
                <div style="margin: 20px; padding: 10; display: table; margin: 20px auto;"> 
                    <input type="submit" value="Skicka order"class="btn btn-outline-dark" id="finnishBtn"></input>
                </div>
            </div>
    </div>

    <div>
      <footer class="footer-bottom" > 
        <hr>
        <p class="p-footer">
            Copyright &copy; 2021 - Sara's webbshop
        </p> 
    </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
    crossorigin="anonymous"></script>

    <script>
      let products = [];
      $(document).ready(run)

      $(document).on('click', ".add1btn", addRemoveItem);

      $(document).on('click', "#finnishBtn", validateForm)

      function run(){
        products = JSON.parse(localStorage.getItem("cartItems"));
        addItemsToCart();
      }

      function addItemsToCart(){
        $("#cart").empty();
        let totalSum = 0;
        let output = "";
        let counter = 1;

        if(products!=null){

          products.forEach((e)  => {
            output = 
            `<tr>
              <th scope="row" class="tableclass">${counter}</th>
              <td>
                <img src=${e.image} class = "pic" alt = Placeholder image class="m-3 pic">
              </td>
              <td class="title">${e.title}</td>
              <td id="price${counter}">${e.price}</td>
              <td id="add-remove">
                  <button type="button" class="btn btn-outline-dark add1btn " style = "padding: 0 4px" >-</button>
                  <div id="qty${counter}">${e.qty}</div>
                  <button type="button" class="btn btn-outline-dark add1btn" style = "padding: 0 4px">+</button>
              </td>
              <td id="total${counter}"></td>
            </tr>`

            $("#cart").append(output);

            let sum = $(`#price${counter}`).text()* $(`#qty${counter}`).text();
            totalSum += sum;
            $(`#total${counter}`).append(sum);

            counter++;
          })
          $("#totalTotal").text(totalSum.toFixed(2));
        }
        else{
          $("#infoForm").hide();
        }
      }

      function findItem(title){
        let item = null;
        products.forEach((e) => {
          if(e.title == title)
            item = e;
        })
        return item;
      }

      function addRemoveItem(){
        let temp = parseInt($(this).siblings("div").html());
        let title = $(this).parent().siblings(".title").html();
        let item = findItem(title);
        
        if($(this).text()=="-" && temp>0){
          item.qty -= 1;        
        }
        else if($(this).text()=="+"){
          item.qty += 1;
        }
        else{
          products.array.forEach(element => {
            
          });
        }
        
        localStorage.setItem("cartItems", JSON.stringify(products));
        addItemsToCart();
      }
      
      function validateForm(){
        let firstName = $("#firstName").val();
        let lastName = $("#lastName").val();
        let email = $("#email").val();
        let phone = $("#phone").val();
        let street = $("#street").val();
        let zipCode = $("#zipCode").val();
        let city = $("#com").val();

        let validFname = /^[a-zA-ZåäöÅÄÖ]+$/g
        let validLname = /^[a-zA-ZåäöÅÄÖ]+$/g
        let validzip = /[0-9]{5}/g
        let validMail = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        let validPhone = /[0-9]{9,10}/g;
        let validStreet = /^[a-zA-ZåäöÅÄÖ]+\s+\d{1,3}/g;
        let validCom = /^[a-zA-ZåäöÅÄÖ]+$/g

        let isValid =  true;

        if(firstName.length>0 && validFname.test(firstName)) {
          $("#invalidFname").html("");
          console.log("rätt förnamn")
        }
        else{
          $("#invalidFname").html("Fel förnamn");
          isValid = false;
          console.log("fel förnamn")
        }
        if(lastName.length>0 && validLname.test(lastName)) {
          $("#invalidLname").html("");
          console.log("rätt förnamn")
        }
        else{
          console.log("fel efternamn")
          isValid = false;
          $("#invalidLname").html("Fel efternamn");
        }
        if(email.length>=5 && validMail.test(email.toLowerCase())) {
          $("#invalidEmail").html("");
          console.log("rätt email")
        }
        else{
          $("#invalidEmail").html("Fel emailadress");
          isValid = false;
          console.log("fel email")
        }
        if(phone.length>=9 && phone.length <=10 && validPhone.test(phone)) {
          $("#invalidPhone").html("");
          console.log("rätt telefon")
        }
        else{
          $("#invalidPhone").html("Fel telefonnummer");
          isValid = false;
          console.log("fel telefon")
        }
        if(street.length>6 && validStreet.test(street)) {
          $("#invalidAdress").html("");
          console.log("rätt gatuadress")
        }
        else{
          $("#invalidAdress").html("Fel gatunamn");
          isValid = false;
          console.log("fel gatuadress")
        }
        if(zipCode.length==5 && validzip.test(zipCode)) {
          $("#invalidZip").html("");
          console.log("rätt postnr")
        }
        else{
          $("#invalidZip").html("Fel postnummer");
          isValid = false;
          console.log("fel postnr")
        }
        if(city.length>2 && validCom.test(city)) {
          $("#invalidCom").html("");
          console.log("rätt ort")
        }
        else{
          $("#invalidCom").html("Fel ort");
          isValid = false;
          console.log("fel ort")
        }

        console.log(isValid);

        if(isValid){
          $("#page").load("endpage.html")
        }

      }
      
    </script>
    
</body>
</html>